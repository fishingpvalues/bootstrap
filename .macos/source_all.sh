#!/usr/bin/env bash\n\n# Exit on error\nset -e\n\n# Check if running as root\nif [ "$EUID" -ne 0 ]; then\n    echo "Please run with sudo"\n    exit 1\nfi\n\n# Check if running on macOS\nif [[ "$(uname)" != "Darwin" ]]; then\n    echo "This script is only for macOS"\n    exit 1\nfi\n\n# Function to handle errors\nhandle_error() {\n    local app="$1"\n    echo "Error occurred while configuring $app. Continuing with other apps..."\n}\n\n# Function to safely kill applications\nkill_app() {\n    local app="$1"\n    if pgrep -x "$app" >/dev/null; then\n        killall "$app" &>/dev/null || true\n        sleep 1\n    fi\n}\n\n# Create necessary directories\nmkdir -p "${HOME}/Library/Preferences"\nmkdir -p "${HOME}/init"\n\n# Source all app-specific configuration files in order\ndeclare -a config_files=(\n    "system.sh"      # System settings should be first\n    "finder.sh"      # Finder settings\n    "dock.sh"        # Dock settings\n    "safari.sh"      # Safari settings\n    "chrome.sh"      # Chrome settings\n    "terminal.sh"    # Terminal settings\n    "mail.sh"        # Mail settings\n    "spotlight.sh"   # Spotlight settings should be last\n)\n\n# Source each configuration file\nfor config in "${config_files[@]}"; do\n    config_path="${HOME}/.macos/apps/$config"\n    if [ -f "$config_path" ]; then\n        echo "Applying settings from $config..."\n        if ! source "$config_path"; then\n            handle_error "${config%.*}"\n        fi\n    else\n        echo "Warning: Configuration file $config not found"\n    fi\ndone\n\n# Kill affected applications to apply changes\necho "Restarting applications to apply changes..."\n\ndeclare -a apps_to_restart=(\n    "Activity Monitor"\n    "Address Book"\n    "Calendar"\n    "cfprefsd"\n    "Contacts"\n    "Dock"\n    "Finder"\n    "Google Chrome"\n    "Mail"\n    "Messages"\n    "Photos"\n    "Safari"\n    "SystemUIServer"\n    "Terminal"\n)\n\nfor app in "${apps_to_restart[@]}"; do\n    kill_app "$app"\ndone\n\necho "Done. Note that some of these changes require a logout/restart to take effect."\necho "Please save your work and restart your computer for all changes to take effect." 