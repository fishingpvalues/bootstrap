#!/usr/bin/env bash\n\n# Check if running on macOS 10.15 (Catalina) or later\nif [[ $(sw_vers -productVersion | cut -d. -f1) -ge 11 ]] || [[ $(sw_vers -productVersion | cut -d. -f2) -ge 15 ]]; then\n    echo "Note: Some Spotlight settings might need manual configuration on macOS Catalina and later"\nfi\n\n# Hide Spotlight tray-icon (and subsequent helper)\n#sudo chmod 600 /System/Library/CoreServices/Search.bundle/Contents/MacOS/Search\n\n# Safely disable Spotlight indexing for any volume\ndisable_spotlight_indexing() {\n    local volume="$1"\n    if [ -d "$volume" ]; then\n        sudo mdutil -i off "$volume" 2>/dev/null || true\n    fi\n}\n\n# Disable Spotlight indexing for any volume that gets mounted\nsudo defaults write /.Spotlight-V100/VolumeConfiguration Exclusions -array "/Volumes"\n\n# Change indexing order and disable some search results\n# Yosemite-specific search results:\n# MENU_DEFINITION\n# MENU_CONVERSION\n# MENU_EXPRESSION\n# MENU_SPOTLIGHT_SUGGESTIONS (send search queries to Apple)\n# MENU_WEBSEARCH             (send search queries to Apple)\n# MENU_OTHER\ndefaults write com.apple.spotlight orderedItems -array \\n	'{"enabled" = 1;"name" = "APPLICATIONS";}' \\n	'{"enabled" = 1;"name" = "SYSTEM_PREFS";}' \\n	'{"enabled" = 1;"name" = "DIRECTORIES";}' \\n	'{"enabled" = 1;"name" = "PDF";}' \\n	'{"enabled" = 1;"name" = "FONTS";}' \\n	'{"enabled" = 0;"name" = "DOCUMENTS";}' \\n	'{"enabled" = 0;"name" = "MESSAGES";}' \\n	'{"enabled" = 0;"name" = "CONTACT";}' \\n	'{"enabled" = 0;"name" = "EVENT_TODO";}' \\n	'{"enabled" = 0;"name" = "IMAGES";}' \\n	'{"enabled" = 0;"name" = "BOOKMARKS";}' \\n	'{"enabled" = 0;"name" = "MUSIC";}' \\n	'{"enabled" = 0;"name" = "MOVIES";}' \\n	'{"enabled" = 0;"name" = "PRESENTATIONS";}' \\n	'{"enabled" = 0;"name" = "SPREADSHEETS";}' \\n	'{"enabled" = 0;"name" = "SOURCE";}' \\n	'{"enabled" = 0;"name" = "MENU_DEFINITION";}' \\n	'{"enabled" = 0;"name" = "MENU_OTHER";}' \\n	'{"enabled" = 0;"name" = "MENU_CONVERSION";}' \\n	'{"enabled" = 0;"name" = "MENU_EXPRESSION";}' \\n	'{"enabled" = 0;"name" = "MENU_WEBSEARCH";}' \\n	'{"enabled" = 0;"name" = "MENU_SPOTLIGHT_SUGGESTIONS";}'\n\n# Safely restart the Spotlight service\nrestart_spotlight() {\n	# Kill metadata server to restart indexing\n	killall mds &>/dev/null || true\n	\n	# Wait for the service to restart\n	sleep 2\n	\n	# Enable indexing for the main volume\n	sudo mdutil -i on / &>/dev/null || true\n	\n	# Rebuild index if needed (this can take a while)\n	if [ "$1" = "rebuild" ]; then\n		sudo mdutil -E / &>/dev/null || true\n	fi\n}\n\n# Apply settings\nrestart_spotlight "rebuild"\n\n# Disable indexing for any currently mounted external volumes\nfor volume in /Volumes/*; do\n	disable_spotlight_indexing "$volume"\ndone 